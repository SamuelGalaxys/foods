<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>mhaZone</title>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
	<link rel="stylesheet" href="css/ready.css">
	<link rel="stylesheet" href="css/demo.css">
	<script src="js/includeHTML.js"></script>

</head>
<body>
	<div class="wrapper">
		<div class="main-header">
			
			<div class="logo-header">
				<a href="index.html" class="logo">
					mhaZone 마한아존
				</a>
				<button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse" data-target="collapse" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<button class="topbar-toggler more"><i class="la la-ellipsis-v"></i></button>
			</div>
			<nav class="navbar navbar-header navbar-expand-lg">
				<div class="container-fluid">
					
					
					
					<ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
						

						<li class="nav-item dropdown hidden-caret">
							<a class="nav-link dropdown-toggle" href="loginform.html" >
								<i class="la la-user"></i>
							</a>
							
						</li>



						
						<li class="nav-item dropdown hidden-caret">
							<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="la la-bell"></i>
								<span class="notification">!</span>
							</a>
							<ul class="dropdown-menu notif-box" aria-labelledby="navbarDropdown">
								<li>
									<div class="dropdown-title">공지 및 알림</div>
								</li>
								<li>
									<div class="notif-center">


										<a href="#">
											<div class="notif-icon notif-primary"> <i class="la la-user-plus"></i> </div>
											<div class="notif-content">
												<span class="block">
													--
												</span>
												<span class="time">-</span> 
											</div>
										</a>

										<a href="#">
											<div class="notif-icon notif-success"> <i class="la la-comment"></i> </div>
											<div class="notif-content">
												<span class="block">
													--
												</span>
												<span class="time">-</span> 
											</div>
										</a>
										
										
									</div>
								</li>
								<li>
									<a class="see-all" href="javascript:void(0);"> <strong>See all notifications</strong> <i class="la la-angle-right"></i> </a>
								</li>
							</ul>
						</li>

 
						
						
					</div>
				</nav>
			</div>


			<div class="sidebar">
				<div class="scrollbar-inner sidebar-wrapper">
					
					<nav include-html="nav.html"></nav>

					
					


				</div>
			</div>

			<div class="main-panel">
				<div class="content">
					<div class="container-fluid">
						
						
						<h4 class="page-title">익명게시판 </h4>
						 


						<div class="row">
							<div class="col-md-6" id="scrollz" style="overflow:scroll;width:auto; height:1000px;">


								<div class="thanksList"></div>



								 
 
								
								 

							</div>

							<div class="col-md-6">
								 
 

                                <div class="card">
									<div class="card-header">
										<div class="card-title"><a style="color: rgb(100, 28, 182);">익명 게시판</a></div>
									</div>
									<div class="form-group">			 
   
 									<div class="card-body">
										<textarea class="form-control w-100" rows="1" name="subject" id="subject" cols="30" placeholder="익명 게시물 제목"></textarea></br>
										<textarea class="form-control w-100" rows="7" name="comment" id="comment" cols="30" placeholder="익명 게시판의 이용에 따른 책임은 사용자에게 있으며, 특정 학생을 대상으로 한 저격,비방과 희롱 등 불쾌감을 유발하는 글은 봇에 의해 이유불문 삭제됩니다."></textarea></br>

										<div class="card-sub">		
 							
                                            -
 											<button type="button" class="button button-contactForm btn_1 boxed-btn btn btn-primary write" id="write" name="write">익명 게시물 쓰기</button> 
 
										</div>
 
									</div>

 								    </div>

						        </div>


                                <div class="card">
									<div class="card-header">
										<div class="card-title"><a style="color: rgb(100, 28, 182);">마한아존 익명 게시판을 소개합니다!</a></div>
									</div>
									<div class="form-group">			 
   
 									<div class="card-body">

                                        <img src="mhazone.png" style="width: 250px; height: auto; margin: 0px auto;">

										<div class="card-title" style="text-align: left;">마한아 학생에게만 표시되는 익명 게시판입니다.</br>대놓고는 말 할수 없었던 것,</br>또는 자유로운 질문으로 이용해주세요!</div>
								    </br></br></br>
 
									</div>

 								    </div>

						        </div>







							</div>
						</div>


					</div>
				</div>
				<footer class="footer">
					<div class="container-fluid">
						
						
						<div class="copyright ml-auto">
							마닐라한국아카데미 커뮤니티 <a href="http://mhazone.bu.to"> 마한아존</a>
						</div>				
					</div>
				</footer>
			</div>
		</div>
	</div>
</div>



<!-- Modal -->

<div class="modal fade" id="modalUpdateN" tabindex="-1" role="dialog" aria-labelledby="modalUpdatePro" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header bg-primary">
				<h6 class="modal-title"><i class="la la-info-circle"></i> 공지</h6>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body text-center">									
				<div id="scrollmodal" class="card" style="overflow:scroll;width:auto; height:400px;">
					 
					<div class="card-body">
						<div class="card-sub">
							공지가 여기에 표시됩니다. 
						</div>
						<div class="noticelist"></div>

						
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>


 



</body>







<script src="js/core/jquery.3.2.1.min.js"></script>
<script src="js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
<script src="js/core/popper.min.js"></script>
<script src="js/core/bootstrap.min.js"></script>
<script src="js/plugin/chartist/chartist.min.js"></script>
<script src="js/plugin/chartist/plugin/chartist-plugin-tooltip.min.js"></script>
<script src="js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>
<script src="js/plugin/bootstrap-toggle/bootstrap-toggle.min.js"></script>
<script src="js/plugin/jquery-mapael/jquery.mapael.min.js"></script>
<script src="js/plugin/jquery-mapael/maps/world_countries.min.js"></script>
<script src="js/plugin/chart-circle/circles.min.js"></script>
<script src="js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
<script src="js/ready.min.js"></script>
<script>
    includeHTML();
</script>


<script>
	$('#displayNotif').on('click', function(){
		var placementFrom = $('#notify_placement_from option:selected').val();
		var placementAlign = $('#notify_placement_align option:selected').val();
		var state = $('#notify_state option:selected').val();
		var style = $('#notify_style option:selected').val();
		var content = {};

		content.message = 'Turning standard Bootstrap alerts into "notify" like notifications';
		content.title = 'Bootstrap notify';
		if (style == "withicon") {
			content.icon = 'la la-bell';
		} else {
			content.icon = 'none';
		}
		content.url = 'index.html';
		content.target = '_blank';

		$.notify(content,{
			type: state,
			placement: {
				from: placementFrom,
				align: placementAlign
			},
			time: 1000,
		});
	});
</script>


<script src="js/time.js"></script>
<!--login유무 session js 파일 -->
<script src="js/sessionCheck.js"></script>
<!--스크립트 부분. 자신의 스크립트 코드로 변경하세요! -->
<script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
<script>
	
	
    //2초후 실행
    setTimeout(function() {
    //	var element = document.getElementById("scrollz");
    //    element.scrollTop = element.scrollHeight;  //스크롤 내리기
	//	$("#modalUpdateN").modal('show');

    }, 1000);

     

    //스크롤 자동으로 내리기
    //setInterval(updateScroll,1000);   

	 
 




	var firebaseEmailAuth; //파이어베이스 email 인증 모듈 전역변수
	var firebaseDatabase; //파이어베이스 db 모듈 전역변수
	var name; //유저 이름
	var loginUserKey; //로그인한 유저의 부모 key
	var userInfo; //로그인한 유저의 정보 object type






	//파이어 베이스 초기화 코드
	var config = {
		apiKey: "AIzaSyDQLUtjdMgOLDIZlPusi5YPKBiuQduD9Go",
		databaseURL: "https://mhazone-mha-default-rtdb.firebaseio.com/",
        authDomain: "mhazone-mha.firebaseapp.com",
        projectId: "mhazone-mha",
        storageBucket: "mhazone-mha.appspot.com",
        messagingSenderId: "967342331429",
        appId: "1:967342331429:web:8a5689ea4c254f037951cc",
        measurementId: "G-Z33QJ15H02"
	 
	};
	//파이어베이스 초기화
	firebase.initializeApp(config);
	//인증모듈 객체 가져오기
	firebaseEmailAuth = firebase.auth();
	//데이터베이스 모듈객체 가져오기
	firebaseDatabase = firebase.database();

	//세션 체크 함수
	userSessionCheck();



	$(document).ready(function () {

		//메인화면 쓰기버튼 눌렀을 때
		$(document).on('click', '.write', function () {

			//네비게이션 메뉴의 text값 가져오기 - 자바스크립트 dom 방식으로 가져왔다.
			var seseionCheck = document.getElementById("loginmenu").textContent;

			//텍스트 필드에 있는 내용 가져오기!!!!
			comment = $('#comment').val();
			subject = $('#subject').val();

			if (seseionCheck == "로그아웃") {
				//저장하기
				saveThanks();
			} else {
				alert("비 로그인 이용자는 마한아 익명 게시판을 이용할 수 없습니다.")
			}
		});


		$(document).on('click', '.create', function () {

			var seseionCheck = document.getElementById("loginmenu").textContent;

 			if (seseionCheck == "로그아웃") {
				window.location.href = "create.html"

			} else {
				alert("비 로그인 이용자는 마한아 익명 게시판을 이용할 수 없습니다.")
				window.location.href = "loginform.html"

			}
			


		});


	});



	//쓰기 버튼 눌렀을 때 호출 되는 함수
	function saveThanks() {

		//thanks 라는 테이블을 만들고 하위 데이터에 유저 아이디를 넣어준다. 그곳에 push로 가상의 키를 넣고, 객체를 넣어준다.!!!!
		var thankRef = firebaseDatabase.ref("anounymous");

		// 해당 객체의 key 값이 자동으로 생성된다.
		var thank = thankRef.push(); // 해당 객체의 key 값이 자동으로 생성된다.




		//로그인한 유저의 pk값,이름,내용,시간 데이터
		var obj = {
			name: name,
			userkey: loginUserKey,
			comment: comment,
			subject: subject,
			createtime: currentTime
		};
		//위에서 thankRef.push()로 만들어진 key아래 위치에 저장해준다.
		thank.set(obj);
  
		
		alert("글이 업로드 되었습니다");

		$('#comment').val("");
		$('#subject').val("");

	}



	//글 목록가져와서 뿌려주기
	function thanksList() {
		//alert("보드 로드 완료")

		//로그인한 유저라면
		if (loginUserKey) {
			//alert(loginUserKey)
			//글이 저장된 레퍼런스 값 가져오기
			var thanksRef = firebaseDatabase.ref('anounymous');
			//on 함수로 글 목록가져오기
			thanksRef.on('child_added', on_thanks_list)
			var thanksRef = firebaseDatabase.ref('notice');
			thanksRef.on('child_added', on_notice_list)

		} else {
            alert("비 로그인 유저에게는 게시물이 표시되지 않습니다. ");
             
		}

	}

	//게시판 리스트 thanks 테이블의 thanks 키 들을 연속적으로 가져옴...ㅋㅋㅋㅋㅋ
	function on_thanks_list(data) {
		console.log("on_thanks_list() 함수안으로 들어왔습니다 리스트를 가져오겠습니다")
		var key = data.key;

		var Data = data.val();
		var comment = Data.comment;
		var createtime = Data.createtime;
		var name = Data.name;
		var subject = Data.subject;
		var userkey = Data.userkey;

		//무슨값이 넘어오는지 찍어보세요
		//alert(comment +"/"+ createtime + "/"+name +"/"+userkey);


		//리스트 동적으로 붙이기
		var html =
                "<div class=\"card\" id='" + userkey + "' onclick=\"show_user_page(this.id)\">" +
                "<div class=\"card-header\">" +
                "<h4 class=\"media-heading\"><strong STYLE=\"color: #5f31e0; font-size: 16pt\">" + subject + "</strong>" +
                " <span STYLE=\"color: #14014a; font-size: 11pt\">" + "</br>" + comment + "</span></h4>" +
                "<p STYLE=\"color: #3409b5; font-size: 10pt\">" + "<i class=\"la la-user\">" + "</i>" + "익명이" + " :: " + createtime + "</p></div></div>";

         //   $(".thanksList").append(html);   //아래로 붙이기
            $(".thanksList").prepend(html);   //위로 붙이기

 

	}




	function on_notice_list(data) {
		console.log("on_thanks_list() 함수안으로 들어왔습니다 리스트를 가져오겠습니다")
		var key = data.key;

		var Data = data.val();
		var comment = Data.comment;
		var createtime = Data.createtime;
		var name = Data.name;
		var subject = Data.subject;
		var userkey = Data.userkey;

		//무슨값이 넘어오는지 찍어보세요
		//alert(comment +"/"+ createtime + "/"+name +"/"+userkey);


		//리스트 동적으로 붙이기
		var html =
                "<div class=\"card\" id='" + userkey + "' onclick=\"show_user_page(this.id)\">" +
                "<div class=\"card-header\">" +
                "<h4 class=\"media-heading\"><strong STYLE=\"color: #424242; font-size: 16pt\">" + subject + "</strong>" +
                " <span STYLE=\"color: black; font-size: 11pt\">" + "</br>" + comment + "</span></h4>" +
                "<p STYLE=\"color: black; font-size: 8pt\">" + name + " :: " + createtime + "</p></div></div>";

            $(".noticelist").prepend(html);

 

	}

</script>


</html>